#!/bin/bash
set -e

usage() {
	echo "git pr log <pull_number> [<remote>]"
	exit $1
}

remote=""
pr=""
declare -a list
while [ $# -ge 1 ]; do
	case $1 in
	--help|-h|--usage|-\?)
		usage 0
		;;
	--remote=*)
		remote=${1#--remote=} && shift
		continue
		;;
	--remote)
		[ $# -ge 2 ] && remote=$2 && shift 2
		continue
		;;
	--pr=*)
		pr=${1#--pr=} && shift
		continue
		;;
	--pr)
		[ $# -ge 2 ] && pr=$2 && shift 2
		continue
		;;
	*)
		list[${#list[*]}]=$1
		;;
	esac
	shift
done
eval set -- "${list[$@]}"

if [ -z $pr ]; then
	pr=${1} && shift
fi
pr=${pr#pr/}
if [ -z $remote ]; then
	remote=${1:-upstream}
	shift >/dev/null 2>&1 || :
fi

merge=""
if [ -f ".git/refs/remotes/${remote}/pr-merge/${pr}" ]; then
	merge=$(cat ".git/refs/remotes/${remote}/pr-merge/${pr}")
fi
exec git rev-parse --no-flags "${merge}..refs/remotes/${remote}/pr/${pr}" "$@"
